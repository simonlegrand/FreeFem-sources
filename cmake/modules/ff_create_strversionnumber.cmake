function(ff_create_strversionnumber)

  # execute_process(
  #   COMMAND date
  #   OUTPUT_VARIABLE VersionFreeFemDate
  # )
  # A Tester pour plus de portabilit√©
  # string(TIMESTAMP VersionFreeFemDate <format>)
  if(NOT EXISTS "${CMAKE_BINARY_DIR}/strversionnumber.cpp")
    message(STATUS "Configuring version number")
    string(TIMESTAMP VersionFreeFemDate "%b %a %d - %H:%M:%S - %Y")  
    execute_process(
      COMMAND git --git-dir=${CMAKE_SOURCE_DIR}/.git describe --tags
      OUTPUT_VARIABLE GitVersion
    )
    if (NOT GitVersion)
      set(GitVersion "no git")
    endif()
    
    # Remove trailing newline
    string(STRIP ${GitVersion} GitVersion)
    string(STRIP ${VersionFreeFemDate} VersionFreeFemDate)
    
    file(READ ${CMAKE_SOURCE_DIR}/src/fflib/strversionnumber.m4 STRVERSIONNUMBER_CONTENT)
    
    string(REPLACE VersionFreeFemDate ${VersionFreeFemDate} CONFIGURED_CONTENT_TMP "${STRVERSIONNUMBER_CONTENT}")
    string(REPLACE GitVersion ${GitVersion} CONFIGURED_CONTENT "${CONFIGURED_CONTENT_TMP}")
  
    file(WRITE ${CMAKE_BINARY_DIR}/strversionnumber.cpp "${CONFIGURED_CONTENT}")
  endif()
# execute_process(COMMAND "date" OUTPUT_VARIABLE VersionFreeFemDate)
# string(STRIP ${VersionFreeFemDate} VersionFreeFemDate)
# file(WRITE ${CMAKE_SOURCE_DIR}/src/fflib/strversionnumber.cpp
# "// TODO: remove this block as soon as autoconf is removed from FreeFEM\n
# #ifndef CMAKE\n
# #include \"config-wrapper.h\"\n
# #endif\n
# \n
# #include \"strversionnumber.hpp\" // [[file:strversionnumber.hpp]] \n
# #include <cstdlib> \n
# using namespace std;\n
# #define TOSTRING1(i) #i \n
# #define TOSTRING(i) TOSTRING1(i) \n
# \n
# //#include <sstream>\n
# #include <cstdio>\n
# using namespace std;\n
# \n
# double VersionNumber(){\n
#   #define VersionFreeFem ${FREEFEM_VERSION} // Generated by CMake \n
#   return VersionFreeFem;\n
# }\n
# \n
# string StrVersionNumber(){\n
# //  std::ostringstream buffer;\n
# //  buffer.precision(8);\n
# //  buffer<<VersionNumber();\n
#   static char buffer[100];\n
#   sprintf(buffer,\" %9f (date ' ${VersionFreeFemDate}')\",VersionNumber());\n
#   return buffer; //.str()+\" (date ${VersionFreeFemDate})\" ;\n
# }")



endfunction(ff_create_strversionnumber)
